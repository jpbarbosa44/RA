<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR.js - Jo√£o e Hadassa</title>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body, html { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
      .a-canvas { z-index: 1 !important; }
      video { z-index: 0 !important; }
      
      #info {
        position: absolute; top: 10px; left: 10px;
        background: rgba(0, 0, 0, 0.7); color: white;
        padding: 15px; border-radius: 8px; z-index: 1000; max-width: 300px;
      }
      #info h3 { margin: 0 0 10px 0; font-size: 16px; }
      #info p { margin: 5px 0; font-size: 12px; line-height: 1.4; }

      #controls {
        position: absolute; bottom: 20px; left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7); padding: 15px;
        border-radius: 8px; z-index: 1000; display: flex; gap: 10px;
        white-space: nowrap; 
      }
      
      button {
        background: #4CAF50; color: white; border: none;
        padding: 10px 20px; border-radius: 5px; cursor: pointer;
        font-size: 14px; transition: background 0.3s;
      }
      button:hover { background: #45a049; }
      
      #status {
        position: absolute; top: 10px; right: 10px;
        background: rgba(255, 87, 34, 0.9); color: white;
        padding: 10px 15px; border-radius: 5px; z-index: 1000; font-size: 12px;
      }
      #status.found { background: rgba(76, 175, 80, 0.9); }
    </style>
  </head>

  <body>
    <div id="info">
      <h3>Projeto RA</h3>
      <p>Desenvolvido por: <strong>Jo√£o e Hadassa</strong></p>
      <p>Aponte para o marcador Hiro</p>
    </div>
    <div id="status">Procurando marcador...</div>
    <div id="controls">
      <button id="rotateBtn">Girar</button>
      <button id="scaleBtn">Aumentar</button>
      <button id="animateBtn">Animar</button>
      <button id="resetBtn">Resetar</button>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      renderer="logarithmicDepthBuffer: true; colorManagement: true;"
      vr-mode-ui="enabled: false"
    >
      <a-assets>
        <a-asset-item id="macaco" src="./assets/logo_macaco.glb"></a-asset-item>
      </a-assets>

      <a-marker 
        id="marker" type="pattern" url="assets/pattern-hiro.patt"
        raycaster="objects: .clickable" emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5"
      >
        <a-entity position="0 1.3 0" scale="2 2 2">
            <a-text value="Projeto desenvolvido por" align="center" position="0 0.25 0" color="#039EF5" width="3"></a-text>
            <a-text value="Joao e Hadassa" align="center" position="0 0 0" color="#4BCBCE" width="4" font="roboto"></a-text>
        </a-entity>

        <a-entity id="modelGroup" position="0 0 0">
          <a-entity 
            id="modelo"
            gltf-model="#macaco" 
            position="0 0 0" rotation="0 0 0" scale="0.5 0.5 0.5"
            class="clickable"
            animation__rotate="property: rotation; to: 0 360 0; loop: false; dur: 2000; easing: easeInOutQuad; autoplay: false"
            animation__bounce="property: position; to: 0 0.5 0; loop: false; dur: 1000; easing: easeInOutQuad; autoplay: false; dir: alternate"
          >
          </a-entity>
          
          <a-light type="ambient" color="#ffffff" intensity="1"></a-light>
          <a-light type="directional" color="#ffffff" intensity="1.5" position="1 1 1"></a-light>
        </a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const modelo = document.getElementById('modelo');
      const marker = document.getElementById('marker');
      const status = document.getElementById('status');
      
      let isAnimating = false;
      let currentScale = 0.5;
      let rotationY = 0;

      modelo.addEventListener('model-loaded', () => {
        const obj = modelo.getObject3D('mesh');
        if (obj) {
          obj.traverse((node) => {
            if (node.isMesh) {
              node.material.color.set('#08BED3'); 
            }
          });
        }
      });

      marker.addEventListener('markerFound', () => {
        status.textContent = '‚úì Marcador encontrado!';
        status.classList.add('found');
      });

      marker.addEventListener('markerLost', () => {
        status.textContent = 'Procurando marcador...';
        status.classList.remove('found');
      });

      document.getElementById('rotateBtn').addEventListener('click', () => {
        if (!isAnimating) {
          rotationY += 90;
          modelo.setAttribute('rotation', `0 ${rotationY} 0`);
        }
      });

      document.getElementById('scaleBtn').addEventListener('click', () => {
        currentScale = currentScale === 0.5 ? 1.0 : 0.5;
        modelo.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
        document.getElementById('scaleBtn').textContent = currentScale === 0.5 ? 'Aumentar' : 'Diminuir';
      });

      document.getElementById('animateBtn').addEventListener('click', () => {
        if (!isAnimating) {
          isAnimating = true;
          modelo.removeAttribute('animation__rotate');
          modelo.removeAttribute('animation__bounce');
          setTimeout(() => {
            modelo.setAttribute('animation__rotate', "property: rotation; to: 0 360 0; loop: false; dur: 2000; easing: easeInOutQuad; autoplay: true");
            modelo.setAttribute('animation__bounce', "property: position; to: 0 0.5 0; loop: false; dur: 1000; easing: easeInOutQuad; autoplay: true; dir: alternate");
          }, 10);
          setTimeout(() => { isAnimating = false; }, 2000);
        }
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        currentScale = 0.5; rotationY = 0;
        modelo.setAttribute('scale', '0.5 0.5 0.5');
        modelo.setAttribute('rotation', '0 0 0');
        modelo.setAttribute('position', '0 0 0');
        document.getElementById('scaleBtn').textContent = 'üîç Aumentar';
      });

      console.log('Sistema AR Pronto: Modelo Pintado.');
    </script>
  </body>
</html>