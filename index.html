<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js + Modelo GLB Interativo</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.3/aframe/build/aframe-ar.min.js"></script>

    <style>
      body, html {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }

      #info {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 15px;
        border-radius: 8px;
        z-index: 1000;
        max-width: 300px;
      }

      #info h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
      }

      #info p {
        margin: 5px 0;
        font-size: 12px;
        line-height: 1.4;
      }

      #controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px;
        border-radius: 8px;
        z-index: 1000;
        display: flex;
        gap: 10px;
      }

      button {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      button:hover {
        background: #45a049;
      }

      button:active {
        transform: scale(0.95);
      }

      #status {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 87, 34, 0.9);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1000;
        font-size: 12px;
      }

      #status.found {
        background: rgba(76, 175, 80, 0.9);
      }
    </style>
  </head>

  <body>
    <!-- Informa√ß√µes -->
    <div id="info">
      <h3>üéØ AR.js - Realidade Aumentada</h3>
      <p>üì∑ Aponte a c√¢mera para o marcador Hiro</p>
      <p>üîÑ Use os bot√µes para interagir com o modelo</p>
    </div>

    <!-- Status do marcador -->
    <div id="status">Procurando marcador...</div>

    <!-- Controles -->
    <div id="controls">
      <button id="rotateBtn">üîÑ Girar</button>
      <button id="scaleBtn">üîç Aumentar</button>
      <button id="animateBtn">‚ú® Animar</button>
      <button id="resetBtn">‚Ü∫ Resetar</button>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
    >
      <!-- Carregar modelo antes de usar -->
      <a-assets>
        <a-asset-item id="macaco" src="./assets/logo_macaco.glb"></a-asset-item>
      </a-assets>

      <!-- Marcador Hiro -->
      <a-marker 
        id="marker" 
        type="pattern" 
        url="assets/pattern-hiro.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
      >
        <!-- Grupo para o modelo -->
        <a-entity id="modelGroup" position="0 0 0">
          <!-- Modelo GLB -->
          <a-entity 
            id="modelo"
            gltf-model="#macaco" 
            position="0 0 0"
            rotation="0 0 0"
            scale="0.5 0.5 0.5"
            class="clickable"
            animation__rotate="property: rotation; to: 0 360 0; loop: false; dur: 2000; easing: easeInOutQuad; autoplay: false"
            animation__bounce="property: position; to: 0 0.5 0; loop: false; dur: 1000; easing: easeInOutQuad; autoplay: false; dir: alternate"
          >
          </a-entity>

          <!-- Ilumina√ß√£o ambiente -->
          <a-light type="ambient" color="#fff" intensity="0.8"></a-light>
          <a-light type="directional" color="#fff" intensity="0.5" position="1 1 1"></a-light>
        </a-entity>
      </a-marker>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Elementos
      const modelo = document.getElementById('modelo');
      const modelGroup = document.getElementById('modelGroup');
      const marker = document.getElementById('marker');
      const status = document.getElementById('status');
      
      // Estado
      let isAnimating = false;
      let currentScale = 0.5;
      let rotationY = 0;

      // Detectar quando o marcador √© encontrado/perdido
      marker.addEventListener('markerFound', () => {
        status.textContent = '‚úì Marcador encontrado!';
        status.classList.add('found');
      });

      marker.addEventListener('markerLost', () => {
        status.textContent = 'Procurando marcador...';
        status.classList.remove('found');
      });

      // Bot√£o Girar
      document.getElementById('rotateBtn').addEventListener('click', () => {
        if (!isAnimating) {
          rotationY += 90;
          modelo.setAttribute('rotation', `0 ${rotationY} 0`);
        }
      });

      // Bot√£o Aumentar/Diminuir
      document.getElementById('scaleBtn').addEventListener('click', () => {
        currentScale = currentScale === 0.5 ? 1.0 : 0.5;
        modelo.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
        document.getElementById('scaleBtn').textContent = 
          currentScale === 0.5 ? 'üîç Aumentar' : 'üîç Diminuir';
      });

      // Bot√£o Animar
      document.getElementById('animateBtn').addEventListener('click', () => {
        if (!isAnimating) {
          isAnimating = true;
          
          // Rota√ß√£o
          const rotateAnim = modelo.components.animation__rotate;
          rotateAnim.beginAnimation();
          
          // Bounce
          const bounceAnim = modelo.components.animation__bounce;
          bounceAnim.beginAnimation();
          
          setTimeout(() => {
            isAnimating = false;
          }, 2000);
        }
      });

      // Bot√£o Resetar
      document.getElementById('resetBtn').addEventListener('click', () => {
        currentScale = 0.5;
        rotationY = 0;
        modelo.setAttribute('scale', '0.5 0.5 0.5');
        modelo.setAttribute('rotation', '0 0 0');
        modelo.setAttribute('position', '0 0 0');
        document.getElementById('scaleBtn').textContent = 'üîç Aumentar';
      });

      // Log de inicializa√ß√£o
      console.log('AR.js inicializado com sucesso!');
    </script>
  </body>
</html>